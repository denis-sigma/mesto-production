(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();const u={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"e6b42cbe-a82c-49a0-8c2a-8be118bf8b8d","Content-Type":"application/json"}},d=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),j=()=>fetch(`${u.baseUrl}/users/me`,{headers:u.headers}).then(d),$=()=>fetch(`${u.baseUrl}/cards`,{headers:u.headers}).then(d),J=({name:e,about:t})=>fetch(`${u.baseUrl}/users/me`,{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e,about:t})}).then(d),R=e=>fetch(`${u.baseUrl}/users/me/avatar`,{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e})}).then(d),z=(e,t)=>fetch(`${u.baseUrl}/cards`,{method:"POST",headers:u.headers,body:JSON.stringify({name:e,link:t})}).then(d),w=e=>fetch(`${u.baseUrl}/cards/${e}`,{method:"DELETE",headers:u.headers}).then(d),F=(e,t)=>fetch(`${u.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:u.headers}).then(d),K=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),A=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:c})=>{const r=K(),s=r.querySelector(".card__like-button"),a=r.querySelector(".card__control-button_type_delete"),i=r.querySelector(".card__control-button_type_info"),l=r.querySelector(".card__image"),B=r.querySelector(".card__like-count");return l.src=e.link,l.alt=e.name,r.querySelector(".card__title").textContent=e.name,B&&e.likes!==void 0&&(B.textContent=e.likes.length||0),e.ownerId!==e.currentUserId&&(a.style.display="none"),o&&s.addEventListener("click",()=>o(s)),n&&a.addEventListener("click",()=>n(r)),c&&i&&i.addEventListener("click",()=>c(e.id)),t&&l.addEventListener("click",()=>t({name:e.name,link:e.link})),r},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");p(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},p=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},G=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{p(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&p(e)})};function Q(e,t,o){t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?Y(e,t,o):X(e,t,o)}function X(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=t.validationMessage,n.classList.add(o.errorClass)}function Y(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)}function Z(e){return e.some(t=>!t.validity.valid)}function D(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function ee(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function M(e,t,o){Z(e)?D(t,o):ee(t,o)}function te(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);M(o,n,t),o.forEach(c=>{c.addEventListener("input",()=>{Q(e,c,t),M(o,n,t)})})}function oe(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{te(o,e)})}const S=document.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),k=v.querySelector(".popup__form"),O=k.querySelector(".popup__input_type_name"),W=k.querySelector(".popup__input_type_description"),g=document.querySelector(".popup_type_new-card"),f=g.querySelector(".popup__form"),ne=f.querySelector(".popup__input_type_card-name"),re=f.querySelector(".popup__input_type_url"),C=document.querySelector(".popup_type_image"),U=C.querySelector(".popup__image"),ce=C.querySelector(".popup__caption"),se=document.querySelector(".profile__edit-button"),ie=document.querySelector(".profile__add-button"),L=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),I=document.querySelector(".popup_type_edit-avatar"),E=I.querySelector(".popup__form"),le=E.querySelector(".popup__input"),ae=document.querySelector("#popup-info-definition-template").content;document.querySelector("#popup-info-user-preview-template").content;const m=document.querySelector(".popup_type_info"),ue=m.querySelector(".popup__title"),y=m.querySelector(".popup__info"),T=m.querySelector(".popup__text"),P=m.querySelector(".popup__list");let b=null;const H=({name:e,link:t})=>{U.src=t,U.alt=e,ce.textContent=e,_(C)},de=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Сохранение...",J({name:O.value,about:W.value}).then(n=>{L.textContent=n.name,q.textContent=n.about,p(v)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},pe=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Сохранение...",R(le.value).then(n=>{x.style.backgroundImage=`url(${n.avatar})`,p(I)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},_e=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Создание...",t.disabled=!0,z(ne.value,re.value).then(n=>{const c=A({name:n.name,link:n.link,likes:n.likes,ownerId:n.owner._id,currentUserId:b,id:n._id},{onPreviewPicture:H,onLikeIcon:r=>{const s=r.classList.contains("card__like-button_is-active");r.classList.toggle("card__like-button_is-active");const a=c.querySelector(".card__like-count");if(a){const i=parseInt(a.textContent)||0;a.textContent=s?i-1:i+1}F(n._id,s).then(i=>{const l=c.querySelector(".card__like-count");l&&(l.textContent=i.likes.length)}).catch(i=>{console.log(i),r.classList.toggle("card__like-button_is-active");const l=c.querySelector(".card__like-count");l&&(l.textContent=n.likes.length)})},onDeleteCard:r=>{const s=r.querySelector(".card__control-button_type_delete");s&&(s.disabled=!0),w(n._id).then(()=>{r.remove()}).catch(a=>{console.log(a),s&&(s.disabled=!1)})},onInfoClick:V});S.prepend(c),p(g),f.reset()}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o,t.disabled=!1})},fe=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),h=(e,t)=>{const o=ae.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},me=e=>{const t=document.createElement("li");return t.className="popup__list-item popup__list-item_type_badge",t.textContent=e.name||"Пользователь",t},V=e=>{y.innerHTML="",P.innerHTML="",$().then(t=>{const o=t.find(n=>n._id===e);if(!o){console.error("Карточка не найдена");return}ue.textContent=o.name,y.append(h("Дата создания:",fe(new Date(o.createdAt)))),y.append(h("Автор:",o.owner.name)),y.append(h("Лайков:",o.likes.length.toString())),o.likes.length>0?(T.textContent="Лайкнули:",o.likes.forEach(n=>{P.append(me(n))})):T.textContent="Пока никто не лайкнул",_(m)}).catch(t=>{console.log(t)})};k.addEventListener("submit",de);f.addEventListener("submit",_e);E.addEventListener("submit",pe);se.addEventListener("click",()=>{O.value=L.textContent,W.value=q.textContent,_(v)});x.addEventListener("click",()=>{E.reset(),_(I)});ie.addEventListener("click",()=>{f.reset(),_(g)});const ye=document.querySelectorAll(".popup");ye.forEach(e=>{G(e)});const he={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};oe(he);Promise.all([$(),j()]).then(([e,t])=>{L.textContent=t.name,q.textContent=t.about,x.style.backgroundImage=`url(${t.avatar})`,b=t._id,S.innerHTML="",e.forEach(o=>{const n=o.likes&&o.likes.some(r=>r._id===t._id),c=A({name:o.name,link:o.link,likes:o.likes,ownerId:o.owner._id,currentUserId:b,id:o._id},{onPreviewPicture:H,onLikeIcon:r=>{const s=r.classList.contains("card__like-button_is-active");r.classList.toggle("card__like-button_is-active");const a=c.querySelector(".card__like-count");if(a){const i=parseInt(a.textContent)||0;a.textContent=s?i-1:i+1}F(o._id,s).then(i=>{const l=c.querySelector(".card__like-count");l&&(l.textContent=i.likes.length)}).catch(i=>{console.log(i),r.classList.toggle("card__like-button_is-active");const l=c.querySelector(".card__like-count");l&&o.likes&&(l.textContent=o.likes.length)})},onDeleteCard:r=>{const s=r.querySelector(".card__control-button_type_delete");s&&(s.disabled=!0),w(o._id).then(()=>{r.remove()}).catch(a=>{console.log(a),s&&(s.disabled=!1)})},onInfoClick:V});if(n){const r=c.querySelector(".card__like-button");r&&r.classList.add("card__like-button_is-active")}S.append(c)})}).catch(e=>{console.log(e)});
