(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))n(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(c){if(c.ep)return;c.ep=!0;const r=o(c);fetch(c.href,r)}})();const u={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"e6b42cbe-a82c-49a0-8c2a-8be118bf8b8d","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),J=()=>fetch(`${u.baseUrl}/users/me`,{headers:u.headers}).then(p),$=()=>fetch(`${u.baseUrl}/cards`,{headers:u.headers}).then(p),R=({name:e,about:t})=>fetch(`${u.baseUrl}/users/me`,{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e,about:t})}).then(p),z=e=>fetch(`${u.baseUrl}/users/me/avatar`,{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e})}).then(p),K=(e,t)=>fetch(`${u.baseUrl}/cards`,{method:"POST",headers:u.headers,body:JSON.stringify({name:e,link:t})}).then(p),w=e=>fetch(`${u.baseUrl}/cards/${e}`,{method:"DELETE",headers:u.headers}).then(p),F=(e,t)=>fetch(`${u.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:u.headers}).then(p),D=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),A=(e,{onPreviewPicture:t,onLikeIcon:o,onDeleteCard:n,onInfoClick:c})=>{const r=D(),i=r.querySelector(".card__like-button"),a=r.querySelector(".card__control-button_type_delete"),s=r.querySelector(".card__control-button_type_info"),l=r.querySelector(".card__image"),y=r.querySelector(".card__like-count");return l.src=e.link,l.alt=e.name,r.querySelector(".card__title").textContent=e.name,y&&e.likes!==void 0&&(y.textContent=e.likes.length||0),e.ownerId!==e.currentUserId&&(a.style.display="none"),o&&i.addEventListener("click",()=>o(i)),n&&a.addEventListener("click",()=>n(r)),c&&s&&s.addEventListener("click",()=>c(e.id)),t&&l.addEventListener("click",()=>t({name:e.name,link:e.link})),r},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");d(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},d=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},G=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{d(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&d(e)})};function Q(e,t,o){t.validity.patternMismatch&&t.dataset.errorMessage?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?Y(e,t,o):X(e,t,o)}function X(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=t.validationMessage,n.classList.add(o.errorClass)}function Y(e,t,o){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)}function Z(e){return e.some(t=>!t.validity.valid)}function ee(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function te(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}function M(e,t,o){Z(e)?ee(t,o):te(t,o)}function oe(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);M(o,n,t),o.forEach(c=>{c.addEventListener("input",()=>{Q(e,c,t),M(o,n,t)})})}function ne(e){Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{oe(o,e)})}const v=document.querySelector(".places__list"),k=document.querySelector(".popup_type_edit"),g=k.querySelector(".popup__form"),O=g.querySelector(".popup__input_type_name"),W=g.querySelector(".popup__input_type_description"),C=document.querySelector(".popup_type_new-card"),f=C.querySelector(".popup__form"),re=f.querySelector(".popup__input_type_card-name"),ce=f.querySelector(".popup__input_type_url"),L=document.querySelector(".popup_type_image"),U=L.querySelector(".popup__image"),ie=L.querySelector(".popup__caption"),se=document.querySelector(".profile__edit-button"),le=document.querySelector(".profile__add-button"),q=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),I=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_edit-avatar"),B=E.querySelector(".popup__form"),ae=B.querySelector(".popup__input"),ue=document.querySelector("#popup-info-definition-template").content;document.querySelector("#popup-info-user-preview-template").content;const m=document.querySelector(".popup_type_info"),de=m.querySelector(".popup__title"),h=m.querySelector(".popup__info"),T=m.querySelector(".popup__text"),P=m.querySelector(".popup__list");let b=null;const H=({name:e,link:t})=>{U.src=t,U.alt=e,ie.textContent=e,_(L)},pe=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Сохранение...",R({name:O.value,about:W.value}).then(n=>{q.textContent=n.name,x.textContent=n.about,d(k)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},_e=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Сохранение...",z(ae.value).then(n=>{I.style.backgroundImage=`url(${n.avatar})`,d(E)}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o})},fe=e=>{e.preventDefault();const t=e.submitter,o=t.textContent;t.textContent="Создание...",t.disabled=!0,K(re.value,ce.value).then(n=>{const c=A({name:n.name,link:n.link,likes:n.likes,ownerId:n.owner._id,currentUserId:b,id:n._id},{onPreviewPicture:H,onLikeIcon:r=>{const i=r.classList.contains("card__like-button_is-active");r.classList.toggle("card__like-button_is-active");const a=c.querySelector(".card__like-count");if(a){const s=parseInt(a.textContent)||0;a.textContent=i?s-1:s+1}F(n._id,i).then(s=>{const l=c.querySelector(".card__like-count");l&&(l.textContent=s.likes.length)}).catch(s=>{console.log(s),r.classList.toggle("card__like-button_is-active");const l=c.querySelector(".card__like-count");l&&(l.textContent=n.likes.length)})},onDeleteCard:r=>{const i=r.querySelector(".card__control-button_type_delete");i&&(i.disabled=!0),w(n._id).then(()=>{r.remove()}).catch(a=>{console.log(a),i&&(i.disabled=!1)})},onInfoClick:V});v.prepend(c),d(C),f.reset()}).catch(n=>{console.log(n)}).finally(()=>{t.textContent=o,t.disabled=!1})},me=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),S=(e,t)=>{const o=ue.querySelector(".popup__info-item").cloneNode(!0);return o.querySelector(".popup__info-term").textContent=e,o.querySelector(".popup__info-description").textContent=t,o},ye=e=>{const t=document.createElement("li");return t.className="popup__list-item popup__list-item_type_badge",t.textContent=e.name||"Пользователь",t},V=e=>{h.innerHTML="",P.innerHTML="",$().then(t=>{const o=t.find(n=>n._id===e);if(!o){console.error("Карточка не найдена");return}de.textContent=o.name,h.append(S("Дата создания:",me(new Date(o.createdAt)))),h.append(S("Автор:",o.owner.name)),h.append(S("Лайков:",o.likes.length.toString())),o.likes.length>0?(T.textContent="Лайкнули:",o.likes.forEach(n=>{P.append(ye(n))})):T.textContent="Пока никто не лайкнул",_(m)}).catch(t=>{console.log(t)})};g.addEventListener("submit",pe);f.addEventListener("submit",fe);B.addEventListener("submit",_e);se.addEventListener("click",()=>{O.value=q.textContent,W.value=x.textContent,_(k)});I.addEventListener("click",()=>{B.reset(),_(E)});le.addEventListener("click",()=>{f.reset(),_(C)});const he=document.querySelectorAll(".popup");he.forEach(e=>{G(e)});const Se={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};ne(Se);Promise.all([$(),J()]).then(([e,t])=>{q.textContent=t.name,x.textContent=t.about,I.style.backgroundImage=`url(${t.avatar})`,b=t._id,v.innerHTML="",e.forEach(o=>{const n=o.likes&&o.likes.some(r=>r._id===t._id),c=A({name:o.name,link:o.link,likes:o.likes,ownerId:o.owner._id,currentUserId:b,id:o._id},{onPreviewPicture:H,onLikeIcon:r=>{const i=r.classList.contains("card__like-button_is-active");r.classList.toggle("card__like-button_is-active");const a=c.querySelector(".card__like-count");if(a){const s=parseInt(a.textContent)||0;a.textContent=i?s-1:s+1}F(o._id,i).then(s=>{const l=c.querySelector(".card__like-count");l&&(l.textContent=s.likes.length)}).catch(s=>{console.log(s),r.classList.toggle("card__like-button_is-active");const l=c.querySelector(".card__like-count");l&&o.likes&&(l.textContent=o.likes.length)})},onDeleteCard:r=>{const i=r.querySelector(".card__control-button_type_delete"),a=document.querySelector(".popup_type_remove-card"),s=a.querySelector('.popup__form button[type="submit"]');if(i){i.disabled=!0,_(a);const l=s.cloneNode(!0);s.replaceWith(l),l.addEventListener("click",y=>{y.preventDefault(),w(o._id).then(()=>{r.remove(),d(a)}).catch(j=>{console.log(j),i.disabled=!1})})}},onInfoClick:V});if(n){const r=c.querySelector(".card__like-button");r&&r.classList.add("card__like-button_is-active")}v.append(c)})}).catch(e=>{console.log(e)});
